import{r,j as e,B as i,X as M,t as l}from"./index-BKI1WJFD.js";import{B as x}from"./badge-BJ3fx28W.js";import{D as I,a as P,b as R,c as B,d as L}from"./dialog-B56VCDFP.js";import{T as ie,a as le,b as T,c as d,d as ce,e as c}from"./table-B6S2DC1P.js";import{I as k}from"./input-COXMr8KZ.js";import{S as oe,a as de,b as ue,c as me,d as u}from"./select-B-3lH2JU.js";import{g as he,a as xe,r as je,f as ge,s as fe}from"./bank-Bt-U3pis.js";import{L as O}from"./loader-circle-DVwTj61m.js";import{S as Ne}from"./search-D5JcCqlJ.js";import{F as pe}from"./filter-B8QTzNSz.js";import{E as be}from"./eye-KQ9zY5QR.js";import{S as U}from"./send-SMGL7j8p.js";import{C as ve}from"./check-BSI6iiZe.js";import"./index-s_LgtPrL.js";import"./index-DlJsYnWQ.js";import"./chevron-down-9ebR-WP6.js";const Se="https://api.ecohavest.org/api/deposit/bank/images/";function Ce(){const[p,_]=r.useState([]),[G,V]=r.useState([]),[w,z]=r.useState(!0),[a,t]=r.useState(null),[D,q]=r.useState(""),[m,h]=r.useState(null),[$,b]=r.useState(!1),[J,v]=r.useState(!1),[Q,S]=r.useState(!1),[y,g]=r.useState(""),[E,f]=r.useState(""),[F,N]=r.useState(""),[C,X]=r.useState(""),[A,K]=r.useState("ALL"),j=async()=>{try{z(!0);const s=await he();_(s),V(s)}catch(s){console.error("Failed to fetch deposits data:",s),l.error("Failed to fetch Bank deposits data")}finally{z(!1)}};r.useEffect(()=>{let s=p;if(C){const n=C.toLowerCase();s=s.filter(o=>o.user.name.toLowerCase().includes(n)||o.user.email.toLowerCase().includes(n)||o.bankName.toLowerCase().includes(n)||o.bankAccountNumber.toLowerCase().includes(n)||o.bankAccountName.toLowerCase().includes(n))}A!=="ALL"&&(s=s.filter(n=>n.status===A)),V(s)},[C,A,p]);const W=async s=>{h(s);try{await xe(s),l.success("Deposit approved successfully"),j()}catch(n){console.error("Failed to approve deposit:",n),l.error("Failed to approve deposit")}finally{h(null)}},Y=async(s,n)=>{if(!n.trim()){l.error("Rejection reason is required");return}h(s);try{await je(s,n),l.success("Deposit rejected successfully"),j(),b(!1),t(null)}catch(o){console.error("Failed to reject deposit:",o),l.error("Failed to reject deposit")}finally{h(null)}},Z=async s=>{h(s);try{await ge(s),l.success("Deposit marked as failed"),j(),v(!1),t(null)}catch(n){console.error("Failed to mark deposit as failed:",n),l.error("Failed to mark deposit as failed")}finally{h(null)}},ee=async(s,n,o,H)=>{if(!n.trim()||!o.trim()||!H.trim()){l.error("All bank details are required");return}h(s);try{await fe({assignedDepositBankName:n,assignedDepositAccountName:o,assignedDepositAccountNumber:H,depositId:s}),l.success("Instructions sent successfully"),j(),S(!1),t(null),g(""),f(""),N("")}catch(te){console.error("Failed to send instructions:",te),l.error("Failed to send instructions")}finally{h(null)}},se=s=>s?new Date(s).toLocaleString():"N/A",ae=s=>`${parseFloat(s).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})} USD`,ne=s=>{switch(s){case"APPROVED":case"COMPLETED":case"ACTIVE":return e.jsx(x,{className:"bg-green-500",children:"Approved"});case"REJECTED":return e.jsx(x,{variant:"destructive",children:"Rejected"});case"FAILED":return e.jsx(x,{className:"bg-red-500 text-white",children:"Failed"});case"PROCESSING":return e.jsx(x,{className:"bg-blue-500 text-white",children:"Processing"});case"PENDING":default:return e.jsx(x,{variant:"outline",className:"bg-yellow-100 text-yellow-800",children:"Pending"})}},re=s=>s?e.jsx(x,{className:"bg-blue-500 text-white",children:"Instructions Sent"}):e.jsx(x,{variant:"outline",className:"bg-orange-100 text-orange-800",children:"Instructions Pending"});return r.useEffect(()=>{j()},[]),e.jsxs("div",{className:"container mx-auto py-6 md:w-[90%] lg:w-[85%] px-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Bank Deposits"})," ",e.jsx(i,{onClick:j,disabled:w,className:"cursor-pointer",children:w?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"mr-2 h-4 w-4 animate-spin"})," Loading..."]}):"Refresh"})]}),e.jsxs("div",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsx("div",{className:"flex items-center gap-2 w-full md:w-1/2",children:e.jsxs("div",{className:"relative w-full",children:[e.jsx(Ne,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(k,{placeholder:"Search by Name, Email, Bank Name, Account Number, Account Name",value:C,onChange:s=>X(s.target.value),className:"pl-8 w-full"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs(oe,{value:A,onValueChange:K,children:[e.jsx(de,{className:"w-[180px]",children:e.jsx(ue,{placeholder:"Filter by Status"})}),e.jsxs(me,{children:[e.jsx(u,{value:"ALL",children:"All Statuses"}),e.jsx(u,{value:"PENDING",children:"Pending"}),e.jsx(u,{value:"PROCESSING",children:"Processing"}),e.jsx(u,{value:"APPROVED",children:"Approved"}),e.jsx(u,{value:"REJECTED",children:"Rejected"}),e.jsx(u,{value:"FAILED",children:"Failed"}),e.jsx(u,{value:"ACTIVE",children:"Active"}),e.jsx(u,{value:"COMPLETED",children:"Completed"}),e.jsx(u,{value:"CANCELLED",children:"Cancelled"})]})]})]})]}),w?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(O,{className:"animate-spin",size:40})}):e.jsx("div",{className:"bg-sidebar rounded-lg shadow overflow-hidden",children:e.jsxs(ie,{children:[e.jsx(le,{children:e.jsxs(T,{children:[e.jsx(d,{children:"User"}),e.jsx(d,{children:"Email"}),e.jsx(d,{children:"Bank Name"}),e.jsx(d,{children:"Account Name"}),e.jsx(d,{children:"Account Number"}),e.jsx(d,{children:"Amount"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Instructions"}),e.jsx(d,{children:"Date"}),e.jsx(d,{className:"text-right",children:"Actions"})]})}),e.jsx(ce,{children:G.length===0?e.jsx(T,{children:e.jsx(c,{colSpan:10,className:"text-center py-8",children:p.length===0?"No Bank deposits found":"No Bank deposits match your search criteria"})}):G.map(s=>e.jsxs(T,{className:!s.instructionsSent&&(s.status==="PENDING"||s.status==="PROCESSING")?"bg-orange-50 dark:bg-orange-900 border-l-4 border-l-orange-400":"",children:[e.jsx(c,{className:"font-medium",children:s.user.name||s.user.id.substring(0,8)+"..."}),e.jsx(c,{className:"text-sm text-muted-foreground",children:s.user.email}),e.jsx(c,{className:"text-sm",children:s.bankName}),e.jsx(c,{className:"text-sm",children:s.bankAccountName}),e.jsx(c,{className:"text-sm",children:s.bankAccountNumber}),e.jsx(c,{children:ae(s.amount)}),e.jsx(c,{children:ne(s.status)}),e.jsx(c,{children:re(s.instructionsSent)}),e.jsx(c,{children:se(s.createdAt)}),e.jsx(c,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2 items-center",children:[s.paymentProof&&e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>window.open(`${Se}${s.paymentProof}`,"_blank"),children:[e.jsx(be,{className:"h-4 w-4 mr-1"}),"View Proof"]}),!s.instructionsSent&&(s.status==="PENDING"||s.status==="PROCESSING")&&e.jsxs(i,{variant:"outline",size:"sm",className:"cursor-pointer text-blue-600 border-blue-600 hover:bg-blue-50",onClick:()=>{t(s),g(s.assignedDepositBankName||""),f(s.assignedDepositAccountName||""),N(s.assignedDepositAccountNumber||""),S(!0)},disabled:m===s.id,children:[e.jsx(U,{className:"h-4 w-4 mr-1"}),"Send Instructions"]}),(s.status==="PENDING"||s.status==="PROCESSING")&&e.jsxs(e.Fragment,{children:[e.jsxs(i,{variant:"default",size:"sm",className:"bg-green-600 hover:bg-green-700 cursor-pointer",onClick:()=>W(s.id),disabled:m===s.id,children:[e.jsx(ve,{className:"h-4 w-4 mr-1"}),"Approve"]}),e.jsxs(i,{variant:"destructive",size:"sm",className:"cursor-pointer",onClick:()=>{t(s),q(""),b(!0)},disabled:m===s.id,children:[e.jsx(M,{className:"h-4 w-4 mr-1"}),"Reject"]}),e.jsxs(i,{variant:"outline",size:"sm",className:"cursor-pointer text-orange-500 border-orange-500 hover:bg-orange-50",onClick:()=>{t(s),v(!0)},disabled:m===s.id,children:[e.jsx(M,{className:"h-4 w-4 mr-1"}),"Fail"]})]})]})})]},s.id))})]})}),e.jsx(I,{open:!!a&&$,onOpenChange:s=>{s||(t(null),b(!1))},children:e.jsxs(P,{children:[e.jsxs(R,{children:[e.jsx(B,{children:"Reject Bank Deposit"}),e.jsx(L,{children:"Please provide a reason for rejecting this Bank deposit."})]}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsx("textarea",{className:"min-h-[100px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",placeholder:"Enter rejection reason...",value:D,onChange:s=>q(s.target.value)})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(i,{className:"cursor-pointer",variant:"outline",onClick:()=>{t(null),b(!1)},children:"Cancel"}),e.jsx(i,{className:"cursor-pointer",variant:"destructive",onClick:()=>{a&&Y(a.id,D)},disabled:!D.trim()||m===(a==null?void 0:a.id),children:"Confirm Rejection"})]})]})}),e.jsx(I,{open:!!a&&J,onOpenChange:s=>{s||(t(null),v(!1))},children:e.jsxs(P,{children:[e.jsxs(R,{children:[e.jsx(B,{children:"Mark Bank Deposit as Failed"}),e.jsx(L,{children:"Are you sure you want to mark this Bank deposit as failed? This action indicates a technical or processing issue with the deposit."})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(i,{className:"cursor-pointer",variant:"outline",onClick:()=>{t(null),v(!1)},children:"Cancel"}),e.jsx(i,{className:"cursor-pointer",variant:"destructive",onClick:()=>{a&&Z(a.id)},disabled:m===(a==null?void 0:a.id),children:"Confirm Failure"})]})]})}),e.jsx(I,{open:!!a&&Q,onOpenChange:s=>{s||(t(null),S(!1),g(""),f(""),N(""))},children:e.jsxs(P,{children:[e.jsxs(R,{children:[e.jsx(B,{children:"Send Bank Instructions"}),e.jsx(L,{children:"Provide the assigned bank details for this deposit."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{htmlFor:"assignedBankName",className:"text-sm font-medium",children:"Assigned Bank Name"}),e.jsx(k,{id:"assignedBankName",placeholder:"Enter assigned bank name",value:y,onChange:s=>g(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{htmlFor:"assignedAccountName",className:"text-sm font-medium",children:"Assigned Account Name"}),e.jsx(k,{id:"assignedAccountName",placeholder:"Enter assigned account holder name",value:E,onChange:s=>f(s.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{htmlFor:"assignedAccountNumber",className:"text-sm font-medium",children:"Assigned Account Number"}),e.jsx(k,{id:"assignedAccountNumber",placeholder:"Enter assigned account number",value:F,onChange:s=>N(s.target.value)})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(i,{className:"cursor-pointer",variant:"outline",onClick:()=>{t(null),S(!1),g(""),f(""),N("")},children:"Cancel"}),e.jsx(i,{className:"cursor-pointer",onClick:()=>{a&&ee(a.id,y,E,F)},disabled:!y.trim()||!E.trim()||!F.trim()||m===(a==null?void 0:a.id),children:m===(a==null?void 0:a.id)?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"mr-2 h-4 w-4 animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"mr-2 h-4 w-4"}),"Send Instructions"]})})]})]})})]})}const ze=function(){return e.jsx(Ce,{})};export{ze as component};
