import{r as t,u as q,z as i,j as e,L as y,B as A,aB as k,aL as B}from"./index-BQIto1cP.js";import{A as V}from"./accent-card-DIrArBwG.js";import{u as T,s as M,F as O,a as n,b as l,c as d,d as m,e as u,f as D,g as G}from"./form-success-CaH5y40Q.js";import{I as g}from"./input-BqLH5Yi5.js";import{S as H,a as J,b as K,c as Q,d as f}from"./select-B2XGz_ZH.js";import{L as N}from"./loader-circle-BOk8eB1Z.js";import{P as W}from"./plus-Cr9Ssqmy.js";import"./card-BzvdCeMC.js";import"./proxy-DIgwrvJD.js";import"./label-BMrfzeM2.js";import"./circle-alert-CE_xSQ8H.js";import"./check-D8dwS3py.js";import"./index-B_tXCF83.js";import"./index-BXB2o0u6.js";const X=i.object({name:i.string().min(3,"Name must be at least 3 characters long"),prize:i.number(),description:i.string().min(3,"Description must be at least 3 characters long"),categoryId:i.string().min(3,"Category must be at least 3 characters long"),img:i.instanceof(File,{message:"Product is required"}).refine(b=>b.size<=5*1024*1024,{message:"File size must be less than 5MB"})}),de=function(){const[a,S]=t.useTransition(),[P,h]=t.useState(""),[F,w]=t.useState(""),[c,L]=t.useState(),[j,I]=t.useState([]),[x,v]=t.useState(!0),E=q(),o=T({resolver:M(X),defaultValues:{name:"",prize:void 0,description:"",categoryId:"",img:void 0}});t.useEffect(()=>{(async()=>{try{v(!0);const r=await k();I(r)}catch(r){h("Failed to load categories"),console.error("Error loading categories:",r)}finally{v(!1)}})()},[]);function R(s){h(void 0),w(void 0),S(async()=>{try{await B(s.name,s.prize,s.description,s.categoryId,s.img),w("Product added successfully"),E({to:"/admin/products"})}catch(r){h(r instanceof Error?r.message:"Failed to add product")}})}return t.useEffect(()=>()=>{c&&URL.revokeObjectURL(c)},[c]),e.jsx("div",{className:"h-full flex justify-center mt-10 container max-w-2xl w-full mx-auto",children:e.jsx(V,{className:"max-w-2xl mx-auto lg:w-2xl md:w-xl sm:w-lg",title:"New Product",description:"Add a new product to the store",children:e.jsx(O,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(R),className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsx(n,{control:o.control,name:"categoryId",disabled:a||x,render:({field:s})=>e.jsxs(l,{children:[e.jsx(d,{children:"Product Category"}),e.jsxs(H,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(m,{children:e.jsx(J,{children:e.jsx(K,{placeholder:x?"Loading categories...":"Select Category"})})}),e.jsx(Q,{children:x?e.jsx(f,{value:"loading",disabled:!0,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(N,{className:"h-4 w-4 animate-spin mr-2"}),"Loading categories..."]})}):j.length>0?j.map(r=>e.jsx(f,{value:r.id,children:r.name},r.id)):e.jsx(f,{value:"no-categories",disabled:!0,children:"No categories available"})})]}),!x&&j.length===0&&e.jsx("div",{className:"mt-2",children:e.jsxs(y,{to:"/admin/categories/new",search:{callbackURL:"/admin/products/new"},className:"text-sm text-blue-600 hover:text-blue-800 flex items-center",children:[e.jsx(W,{className:"h-3 w-3 mr-1"}),"Create a category first"]})}),e.jsx(u,{})]})}),e.jsx("div",{children:e.jsx(y,{to:"/admin/categories/new",search:{callbackURL:"/admin/products/new"},children:"New Category"})})]}),e.jsx(n,{control:o.control,name:"name",disabled:a,render:({field:s})=>e.jsxs(l,{children:[e.jsx(d,{children:"Product name"}),e.jsx(m,{children:e.jsx(g,{...s,type:"text",placeholder:"Product name",required:!0})}),e.jsx(u,{})]})}),e.jsx(n,{control:o.control,name:"description",disabled:a,render:({field:s})=>e.jsxs(l,{children:[e.jsx(d,{children:"Product description"}),e.jsx(m,{children:e.jsx(g,{...s,type:"text",placeholder:"Product description",required:!0})}),e.jsx(u,{})]})}),e.jsx(n,{control:o.control,name:"prize",disabled:a,render:({field:s})=>e.jsxs(l,{children:[e.jsx(d,{children:"Product price"}),e.jsx(m,{children:e.jsx(g,{...s,type:"number",placeholder:"0.00",step:"0.01",min:"0",onChange:r=>s.onChange(parseFloat(r.target.value)),required:!0})}),e.jsx(u,{})]})}),e.jsx(n,{control:o.control,name:"img",disabled:a,render:({field:{value:s,onChange:r,...z}})=>e.jsxs(l,{children:[e.jsx(d,{children:"Product Image"}),e.jsx(m,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(g,{type:"file",accept:"image/*",onChange:U=>{var C;const p=(C=U.target.files)==null?void 0:C[0];p&&(r(p),L(URL.createObjectURL(p)))},...z,required:!0}),c&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:c,alt:"Product Image preview",className:"max-w-[200px] rounded-lg border"})})]})}),e.jsx(u,{})]})}),e.jsx(D,{message:P}),e.jsx(G,{message:F}),e.jsx(A,{disabled:a,type:"submit",className:"w-full",children:a?e.jsx(N,{className:"h-4 w-4 animate-spin"}):"Add Product"})]})})})})};export{de as component};
