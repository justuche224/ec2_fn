import{r as t,j as e,B as n,X as E,t as d}from"./index-Caxnq4fP.js";import{B as j}from"./badge-CH4Itv7g.js";import{D as A,a as F,b as L,c as R,d as P}from"./dialog-YHpiP2M3.js";import{T as q,a as J,b as w,c as i,d as Q,e as l}from"./table-Cphr1Cof.js";import{I as X}from"./input-9dZTne-k.js";import{S as K,a as W,b as Y,c as Z,d as c}from"./select-wHZoGIvI.js";import{g as ee,a as se,r as ae,f as re}from"./bank-C1XVi6Q_.js";import{L as B}from"./loader-circle-CEWipKhR.js";import{S as te}from"./search-C6J7ZMJF.js";import{F as le}from"./filter-DnOKYwlZ.js";import{E as ne}from"./eye-mqFc8NkX.js";import{C as ie}from"./check-PSB7j7kI.js";import"./index-DKNBjb_u.js";import"./index-WARRLnT4.js";import"./chevron-down-B1mPT4EB.js";const ce="https://api.ecohavest.org/api/deposit/bank/images/";function oe(){const[f,I]=t.useState([]),[y,D]=t.useState([]),[b,S]=t.useState(!0),[r,o]=t.useState(null),[C,k]=t.useState(""),[h,m]=t.useState(null),[T,p]=t.useState(!1),[O,g]=t.useState(!1),[N,V]=t.useState(""),[v,G]=t.useState("ALL"),x=async()=>{try{S(!0);const s=await ee();I(s),D(s)}catch(s){console.error("Failed to fetch deposits data:",s),d.error("Failed to fetch Bank deposits data")}finally{S(!1)}};t.useEffect(()=>{let s=f;if(N){const a=N.toLowerCase();s=s.filter(u=>u.user.name.toLowerCase().includes(a)||u.user.email.toLowerCase().includes(a)||u.bankName.toLowerCase().includes(a)||u.bankAccountNumber.toLowerCase().includes(a)||u.bankAccountName.toLowerCase().includes(a))}v!=="ALL"&&(s=s.filter(a=>a.status===v)),D(s)},[N,v,f]);const z=async s=>{m(s);try{await se(s),d.success("Deposit approved successfully"),x()}catch(a){console.error("Failed to approve deposit:",a),d.error("Failed to approve deposit")}finally{m(null)}},H=async(s,a)=>{if(!a.trim()){d.error("Rejection reason is required");return}m(s);try{await ae(s,a),d.success("Deposit rejected successfully"),x(),p(!1),o(null)}catch(u){console.error("Failed to reject deposit:",u),d.error("Failed to reject deposit")}finally{m(null)}},M=async s=>{m(s);try{await re(s),d.success("Deposit marked as failed"),x(),g(!1),o(null)}catch(a){console.error("Failed to mark deposit as failed:",a),d.error("Failed to mark deposit as failed")}finally{m(null)}},U=s=>s?new Date(s).toLocaleString():"N/A",_=s=>`${parseFloat(s).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})} USD`,$=s=>{switch(s){case"APPROVED":case"COMPLETED":case"ACTIVE":return e.jsx(j,{className:"bg-green-500",children:"Approved"});case"REJECTED":return e.jsx(j,{variant:"destructive",children:"Rejected"});case"FAILED":return e.jsx(j,{className:"bg-red-500 text-white",children:"Failed"});case"PROCESSING":return e.jsx(j,{className:"bg-blue-500 text-white",children:"Processing"});case"PENDING":default:return e.jsx(j,{variant:"outline",className:"bg-yellow-100 text-yellow-800",children:"Pending"})}};return t.useEffect(()=>{x()},[]),e.jsxs("div",{className:"container mx-auto py-6 md:w-[90%] lg:w-[85%] px-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Bank Deposits"})," ",e.jsx(n,{onClick:x,disabled:b,className:"cursor-pointer",children:b?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"mr-2 h-4 w-4 animate-spin"})," Loading..."]}):"Refresh"})]}),e.jsxs("div",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsx("div",{className:"flex items-center gap-2 w-full md:w-1/2",children:e.jsxs("div",{className:"relative w-full",children:[e.jsx(te,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(X,{placeholder:"Search by Name, Email, Bank Name, Account Number, Account Name",value:N,onChange:s=>V(s.target.value),className:"pl-8 w-full"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs(K,{value:v,onValueChange:G,children:[e.jsx(W,{className:"w-[180px]",children:e.jsx(Y,{placeholder:"Filter by Status"})}),e.jsxs(Z,{children:[e.jsx(c,{value:"ALL",children:"All Statuses"}),e.jsx(c,{value:"PENDING",children:"Pending"}),e.jsx(c,{value:"PROCESSING",children:"Processing"}),e.jsx(c,{value:"APPROVED",children:"Approved"}),e.jsx(c,{value:"REJECTED",children:"Rejected"}),e.jsx(c,{value:"FAILED",children:"Failed"}),e.jsx(c,{value:"ACTIVE",children:"Active"}),e.jsx(c,{value:"COMPLETED",children:"Completed"}),e.jsx(c,{value:"CANCELLED",children:"Cancelled"})]})]})]})]}),b?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(B,{className:"animate-spin",size:40})}):e.jsx("div",{className:"bg-sidebar rounded-lg shadow overflow-hidden",children:e.jsxs(q,{children:[e.jsx(J,{children:e.jsxs(w,{children:[e.jsx(i,{children:"User"}),e.jsx(i,{children:"Email"}),e.jsx(i,{children:"Bank Name"}),e.jsx(i,{children:"Account Name"}),e.jsx(i,{children:"Account Number"}),e.jsx(i,{children:"Amount"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Date"}),e.jsx(i,{className:"text-right",children:"Actions"})]})}),e.jsx(Q,{children:y.length===0?e.jsx(w,{children:e.jsx(l,{colSpan:9,className:"text-center py-8",children:f.length===0?"No Bank deposits found":"No Bank deposits match your search criteria"})}):y.map(s=>e.jsxs(w,{children:[e.jsx(l,{className:"font-medium",children:s.user.name||s.user.id.substring(0,8)+"..."}),e.jsx(l,{className:"text-sm text-muted-foreground",children:s.user.email}),e.jsx(l,{className:"text-sm",children:s.bankName})," ",e.jsx(l,{className:"text-sm",children:s.bankAccountName})," ",e.jsx(l,{className:"text-sm",children:s.bankAccountNumber})," ",e.jsx(l,{children:_(s.amount)}),e.jsx(l,{children:$(s.status)}),e.jsx(l,{children:U(s.createdAt)}),e.jsx(l,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2 items-center",children:[s.paymentProof&&e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>window.open(`${ce}${s.paymentProof}`,"_blank"),children:[e.jsx(ne,{className:"h-4 w-4 mr-1"}),"View Proof"]}),(s.status==="PENDING"||s.status==="PROCESSING")&&e.jsxs(e.Fragment,{children:[e.jsxs(n,{variant:"default",size:"sm",className:"bg-green-600 hover:bg-green-700 cursor-pointer",onClick:()=>z(s.id),disabled:h===s.id,children:[e.jsx(ie,{className:"h-4 w-4 mr-1"}),"Approve"]}),e.jsxs(n,{variant:"destructive",size:"sm",className:"cursor-pointer",onClick:()=>{o(s),k(""),p(!0)},disabled:h===s.id,children:[e.jsx(E,{className:"h-4 w-4 mr-1"}),"Reject"]}),e.jsxs(n,{variant:"outline",size:"sm",className:"cursor-pointer text-orange-500 border-orange-500 hover:bg-orange-50",onClick:()=>{o(s),g(!0)},disabled:h===s.id,children:[e.jsx(E,{className:"h-4 w-4 mr-1"}),"Fail"]})]})]})})]},s.id))})]})}),e.jsx(A,{open:!!r&&T,onOpenChange:s=>{s||(o(null),p(!1))},children:e.jsxs(F,{children:[e.jsxs(L,{children:[e.jsx(R,{children:"Reject Bank Deposit"}),e.jsx(P,{children:"Please provide a reason for rejecting this Bank deposit."})]}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsx("textarea",{className:"min-h-[100px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",placeholder:"Enter rejection reason...",value:C,onChange:s=>k(s.target.value)})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(n,{className:"cursor-pointer",variant:"outline",onClick:()=>{o(null),p(!1)},children:"Cancel"}),e.jsx(n,{className:"cursor-pointer",variant:"destructive",onClick:()=>{r&&H(r.id,C)},disabled:!C.trim()||h===(r==null?void 0:r.id),children:"Confirm Rejection"})]})]})}),e.jsx(A,{open:!!r&&O,onOpenChange:s=>{s||(o(null),g(!1))},children:e.jsxs(F,{children:[e.jsxs(L,{children:[e.jsx(R,{children:"Mark Bank Deposit as Failed"}),e.jsx(P,{children:"Are you sure you want to mark this Bank deposit as failed? This action indicates a technical or processing issue with the deposit."})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(n,{className:"cursor-pointer",variant:"outline",onClick:()=>{o(null),g(!1)},children:"Cancel"}),e.jsx(n,{className:"cursor-pointer",variant:"destructive",onClick:()=>{r&&M(r.id)},disabled:h===(r==null?void 0:r.id),children:"Confirm Failure"})]})]})})]})}const De=function(){return e.jsx(oe,{})};export{De as component};
