import{r as n,j as e,B as u,u as H,L as C,az as V,t as A}from"./index-BVlH3n0h.js";import{a as J}from"./withdrawal-paypal-BOxj50Su.js";import{C as w,a as N,b,c as U,d as g,e as v}from"./card-Cn1464GL.js";import{I as D}from"./input-B1UDhOgi.js";import{L as E}from"./label-Dndy2xtm.js";import{F as M,a as T}from"./form-success-B0W-83Lj.js";import{L as W}from"./loader-circle-CnBdTBbm.js";import{A as G}from"./arrow-right-2qW5_HpR.js";import{C as q}from"./chevron-left-CfZso5wv.js";import{C as K}from"./check-BGrFiPcB.js";import"./circle-alert-Cnr54O0J.js";function Q({balanceToWithdrawFrom:t,onFormSubmit:P,isParentSubmitting:d}){const[s,r]=n.useState({paypalName:"",paypalEmail:"",amount:""}),[i,c]=n.useState(""),[x,m]=n.useState(""),y=l=>/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/.test(l),f=async l=>{if(l.preventDefault(),d)return;if(c(""),m(""),s.paypalName.trim()==="")return c("Enter your full name as it appears on PayPal.");if(!y(s.paypalEmail))return c("Enter a valid PayPal email address.");const h=Number(s.amount);if(s.amount===""||isNaN(h)||h<=0)return c("Enter a valid withdrawal amount.");if(t&&h>t.amountUSD)return c(`Withdrawal amount exceeds your available ${t.currency} balance of $${t.amountUSD.toFixed(2)}.`);P(s)};return e.jsxs(w,{className:"w-full max-w-sm",children:[e.jsxs(N,{children:[e.jsx(b,{children:"PayPal Withdrawal"}),t?e.jsxs(U,{children:["Withdraw from your ",t.currency," balance (",`$${t.amountUSD.toFixed(2)}`,") via PayPal. Enter your PayPal details and desired amount in USD below."]}):e.jsx(U,{children:"Enter your PayPal details and desired amount in USD below to withdraw funds."})]}),e.jsx(g,{children:e.jsxs("form",{onSubmit:f,children:[e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{htmlFor:"paypalName",children:"Full Name on PayPal"}),e.jsx(D,{value:s.paypalName,onChange:l=>r({...s,paypalName:l.target.value}),id:"paypalName",type:"text",placeholder:"John Doe",required:!0,disabled:d})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{htmlFor:"paypalEmail",children:"PayPal Email"}),e.jsx(D,{value:s.paypalEmail,onChange:l=>r({...s,paypalEmail:l.target.value}),id:"paypalEmail",type:"email",placeholder:"you@example.com",required:!0,disabled:d})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(E,{htmlFor:"amount",children:"Amount (USD)"}),e.jsx(D,{value:s.amount,onChange:l=>r({...s,amount:l.target.value}),id:"amount",type:"number",placeholder:"100.00",min:"0.01",step:"0.01",required:!0,disabled:d}),t&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Available to withdraw from ",t.currency,": $",t.amountUSD.toFixed(2)]})]})]}),e.jsx("br",{}),e.jsx(M,{message:i}),e.jsx(T,{message:x})]})}),e.jsx(v,{className:"flex-col gap-2",children:e.jsx(u,{type:"submit",className:"w-full",disabled:d,onClick:l=>f(l),children:d?e.jsx(W,{className:"w-4 h-4 animate-spin"}):"Request Withdrawal"})})]})}const X=({currency:t})=>{switch(t){case"BTC":return e.jsx("div",{className:"h-8 w-8 rounded-full bg-orange-500 flex items-center justify-center text-white font-bold",children:"₿"});case"ETH":return e.jsx("div",{className:"h-8 w-8 rounded-full bg-purple-700 flex items-center justify-center text-white font-bold",children:"Ξ"});case"USDT":return e.jsx("div",{className:"h-8 w-8 rounded-full bg-green-600 flex items-center justify-center text-white font-bold",children:"₮"});case"SOL":return e.jsx("div",{className:"h-8 w-8 rounded-full bg-blue-600 flex items-center justify-center text-white font-bold",children:"◎"});case"BNB":return e.jsx("div",{className:"h-8 w-8 rounded-full bg-yellow-500 flex items-center justify-center text-white font-bold",children:"B"});case"LTC":return e.jsx("div",{className:"h-8 w-8 rounded-full bg-gray-500 flex items-center justify-center text-white font-bold",children:"Ł"});default:return e.jsx("div",{className:"h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center",children:"?"})}},oe=function(){const P=H(),[d,s]=n.useState(!0),[r,i]=n.useState(null),[c,x]=n.useState("select-crypto-source"),[m,y]=n.useState(null),[f,l]=n.useState({}),[h,B]=n.useState(!1),[F,R]=n.useState([]),[p,k]=n.useState(null);n.useEffect(()=>{(async()=>{try{s(!0),i(null);const o=await V(),S=Object.entries(o).reduce((j,[z,Y])=>(j[z]=parseFloat(Y)||0,j),{});l(S);const $=Object.keys(S).filter(j=>S[j]>.009);R($),$.length===0&&i("You do not have any crypto balances with sufficient funds ($0.01 or more) to withdraw via PayPal at the moment.")}catch(o){console.error("Failed to load balances for PayPal withdrawal:",o),i("Failed to load your crypto balances. Please try again later.")}finally{s(!1)}})()},[]);const I=(a,o)=>{y({currency:a,amountUSD:o}),x("enter-paypal-details")},O=async a=>{if(!m){i("No crypto source selected. Please go back.");return}B(!0),i(null);try{await J(m.currency,parseFloat(a.amount),a.paypalName,a.paypalEmail),k({sourceCurrency:m.currency,amountUSD:a.amount,paypalName:a.paypalName,paypalEmail:a.paypalEmail}),A.success("PayPal withdrawal request submitted successfully!"),x("confirmation")}catch(o){console.error("PayPal withdrawal error:",o),i("An error occurred while processing your PayPal withdrawal. Please try again."),A.error("Failed to submit PayPal withdrawal request.")}finally{B(!1)}},L=a=>a.toFixed(2);return d?e.jsx("div",{className:"flex h-full min-h-96 items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(W,{className:"mx-auto h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"mt-2 text-lg",children:"Loading your balances..."})]})}):r&&c!=="enter-paypal-details"?e.jsx("div",{className:"flex h-full min-h-96 items-center justify-center",children:e.jsxs(w,{className:"w-full max-w-md",children:[e.jsx(N,{className:"bg-red-50 text-red-700",children:e.jsx(b,{children:"Error"})}),e.jsx(g,{className:"pt-6",children:e.jsx("p",{children:r})}),e.jsx(v,{className:"flex justify-center",children:e.jsx(u,{onClick:()=>window.location.reload(),className:"w-1/2",children:"Try Again"})})]})}):F.length===0&&!d&&!r?e.jsxs("div",{className:"container py-8 mx-auto text-center",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6 text-center",children:"Withdraw via PayPal"}),e.jsx("p",{className:"text-xl text-gray-600 text-center",children:r||"You currently have no crypto balances with sufficient funds ($0.01 or more) to withdraw via PayPal."}),e.jsxs("p",{className:"mt-4",children:[e.jsx(C,{to:"/dashboard/deposit",className:"text-primary hover:underline",children:"Deposit funds"})," ","or"," ",e.jsx(C,{to:"/dashboard",className:"text-primary hover:underline",children:"return to dashboard"}),"."]})]}):c==="select-crypto-source"?e.jsxs("div",{className:"container py-8 mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 text-center",children:"Withdraw via PayPal"}),e.jsx("p",{className:"text-gray-600 mb-8 text-center",children:"Select the crypto balance you wish to withdraw funds from. The selected amount will be sent to your PayPal account in USD."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-w-4xl mx-auto",children:F.map(a=>{const o=f[a]||0;return e.jsxs(w,{className:"hover:shadow-md transition-shadow cursor-pointer",onClick:()=>I(a,o),children:[e.jsx(N,{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(X,{currency:a}),e.jsx(b,{children:a})]})}),e.jsx(g,{children:e.jsxs(U,{children:["Available Balance (USD):"," ",e.jsxs("span",{className:"font-semibold",children:["$",L(o)]})]})}),e.jsx(v,{className:"pt-0",children:e.jsxs(u,{variant:"ghost",className:"ml-auto",size:"sm",children:["Select & Continue ",e.jsx(G,{className:"ml-2 h-4 w-4"})]})})]},a)})}),e.jsx("div",{className:"mt-12 text-center",children:e.jsx(C,{to:"/dashboard/withdraw",children:e.jsxs(u,{variant:"outline",children:[e.jsx(q,{className:"mr-2 h-4 w-4"})," Back to Withdrawal Options"]})})})]}):c==="enter-paypal-details"&&m?e.jsxs("div",{className:"container py-8 mx-auto flex flex-col items-center",children:[e.jsx("div",{className:"w-full max-w-sm mb-6",children:e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>{i(null),x("select-crypto-source")},children:[e.jsx(q,{className:"mr-2 h-4 w-4"})," Back to Select Balance"]})}),e.jsx(Q,{balanceToWithdrawFrom:m,onFormSubmit:O,isParentSubmitting:h}),r&&e.jsx("p",{className:"mt-4 text-sm text-red-600 text-center",children:r})]}):c==="confirmation"&&p?e.jsx("div",{className:"container mx-auto py-8",children:e.jsxs(w,{className:"max-w-lg mx-auto",children:[e.jsxs(N,{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-green-100",children:e.jsx(K,{className:"h-6 w-6 text-green-600"})}),e.jsx(b,{className:"mt-4 text-xl",children:"PayPal Withdrawal Request Submitted"})]}),e.jsxs(g,{className:"text-center space-y-3",children:[e.jsxs("p",{className:"text-gray-700",children:["Your request to withdraw"," ",e.jsxs("span",{className:"font-semibold",children:["$",L(parseFloat(p.amountUSD))]})," ","from your"," ",e.jsx("span",{className:"font-semibold",children:p.sourceCurrency})," ","balance to PayPal user"," ",e.jsx("span",{className:"font-semibold",children:p.paypalEmail})," ","(",p.paypalName,") has been submitted."]}),e.jsx("p",{className:"text-gray-600 text-sm",children:"This will be processed shortly. For now, the details have been logged to the console."}),r&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:r})]}),e.jsxs(v,{className:"flex flex-col sm:flex-row justify-center space-y-2 sm:space-y-0 sm:space-x-4",children:[e.jsx(u,{onClick:()=>{x("select-crypto-source"),y(null),k(null),i(null)},children:"Make Another PayPal Withdrawal"}),e.jsx(u,{variant:"outline",onClick:()=>P({to:"/dashboard"}),children:"Return to Dashboard"})]})]})}):null};export{oe as component};
