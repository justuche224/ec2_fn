import{r as l,j as e,B as h,u as M,L as C,az as G,t as $}from"./index-BKI1WJFD.js";import{a as J}from"./withdrawal-bank-piYzQrHu.js";import{C as p,a as w,b as y,c as B,d as g,e as v}from"./card-D2tBPcb5.js";import{I as N}from"./input-COXMr8KZ.js";import{L as b}from"./label-pumfUz_W.js";import{F as K,a as T}from"./form-success-D94Keyl1.js";import{L as q}from"./loader-circle-DVwTj61m.js";import{A as V}from"./arrow-right-BG38eTkz.js";import{C as L}from"./chevron-left-B9s_2PaO.js";import{C as Z}from"./check-BSI6iiZe.js";import"./circle-alert-1X7729Uh.js";function Q({balanceToWithdrawFrom:s,onFormSubmit:k,isParentSubmitting:o}){const[t,r]=l.useState({bankName:"",accountName:"",accountNumber:"",amount:""}),[i,c]=l.useState(""),[x,m]=l.useState(""),f=async()=>{if(o)return;if(!t.bankName||!t.accountName||!t.accountNumber||!t.amount)return c("Please fill in all fields.");if(c(""),m(""),t.bankName.trim()==="")return c("Enter the name of your bank.");if(t.accountName.trim()==="")return c("Enter the name on the bank account.");if(!/^[0-9A-Za-z\s-]{5,30}$/.test(t.accountNumber.trim()))return c("Enter a valid account number (5-30 alphanumeric characters, spaces, or hyphens).");const n=Number(t.amount);if(t.amount===""||isNaN(n)||n<=0)return c("Enter a valid withdrawal amount.");if(s&&n>s.amountUSD)return c(`Withdrawal amount exceeds your available ${s.currency} balance of $${s.amountUSD.toFixed(2)}.`);k(t)};return e.jsxs(p,{className:"w-full max-w-sm",children:[e.jsxs(w,{children:[e.jsx(y,{children:"Bank Account Withdrawal"}),s?e.jsxs(B,{children:["Withdraw from your ",s.currency," balance (",`$${s.amountUSD.toFixed(2)}`,") to your bank account. Enter your bank details and desired amount in USD below."]}):e.jsx(B,{children:"Enter your bank account details and desired amount in USD below to withdraw funds."})]}),e.jsx(g,{children:e.jsxs("form",{children:[e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"bankName",children:"Bank Name"}),e.jsx(N,{value:t.bankName,onChange:n=>r({...t,bankName:n.target.value}),id:"bankName",type:"text",placeholder:"e.g., Global Standard Bank",required:!0,disabled:o})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"accountName",children:"Account Holder Name"}),e.jsx(N,{value:t.accountName,onChange:n=>r({...t,accountName:n.target.value}),id:"accountName",type:"text",placeholder:"John M. Doe",required:!0,disabled:o})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"accountNumber",children:"Account Number"}),e.jsx(N,{value:t.accountNumber,onChange:n=>r({...t,accountNumber:n.target.value}),id:"accountNumber",type:"text",placeholder:"e.g., 1234567890 or CHK-0012345",required:!0,disabled:o})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(b,{htmlFor:"amount",children:"Amount (USD)"}),e.jsx(N,{value:t.amount,onChange:n=>r({...t,amount:n.target.value}),id:"amount",type:"number",placeholder:"100.00",min:"0.01",step:"0.01",required:!0,disabled:o}),s&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Available to withdraw from ",s.currency,": $",s.amountUSD.toFixed(2)]})]})]}),e.jsx("br",{}),e.jsx(K,{message:i}),e.jsx(T,{message:x})]})}),e.jsx(v,{className:"flex-col gap-2",children:e.jsx(h,{type:"submit",className:"w-full",disabled:o,onClick:f,children:o?e.jsx(q,{className:"w-4 h-4 animate-spin"}):"Request Withdrawal"})})]})}const X=({currency:s})=>{switch(s){case"BTC":return e.jsx("div",{className:"h-8 w-8 rounded-full bg-orange-500 flex items-center justify-center text-white font-bold",children:"₿"});case"ETH":return e.jsx("div",{className:"h-8 w-8 rounded-full bg-purple-700 flex items-center justify-center text-white font-bold",children:"Ξ"});case"USDT":return e.jsx("div",{className:"h-8 w-8 rounded-full bg-green-600 flex items-center justify-center text-white font-bold",children:"₮"});case"SOL":return e.jsx("div",{className:"h-8 w-8 rounded-full bg-blue-600 flex items-center justify-center text-white font-bold",children:"◎"});case"BNB":return e.jsx("div",{className:"h-8 w-8 rounded-full bg-yellow-500 flex items-center justify-center text-white font-bold",children:"B"});case"LTC":return e.jsx("div",{className:"h-8 w-8 rounded-full bg-gray-500 flex items-center justify-center text-white font-bold",children:"Ł"});default:return e.jsx("div",{className:"h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center",children:"?"})}},ie=function(){const k=M(),[o,t]=l.useState(!0),[r,i]=l.useState(null),[c,x]=l.useState("select-crypto-source"),[m,f]=l.useState(null),[n,W]=l.useState({}),[R,D]=l.useState(!1),[A,z]=l.useState([]),[d,U]=l.useState(null);l.useEffect(()=>{(async()=>{try{t(!0),i(null);const u=await G(),S=Object.entries(u).reduce((j,[O,Y])=>(j[O]=parseFloat(Y)||0,j),{});W(S);const E=Object.keys(S).filter(j=>S[j]>.009);z(E),E.length===0&&i("You do not have any crypto balances with sufficient funds ($0.01 or more) to withdraw to a bank account at the moment.")}catch(u){console.error("Failed to load balances for bank withdrawal:",u),i("Failed to load your crypto balances. Please try again later.")}finally{t(!1)}})()},[]);const H=(a,u)=>{f({currency:a,amountUSD:u}),x("enter-bank-details")},I=async a=>{if(!m){i("No crypto source selected. Please go back.");return}D(!0),i(null);try{await J(m.currency,parseFloat(a.amount),a.bankName,a.accountName,a.accountNumber),U({sourceCurrency:m.currency,amountUSD:a.amount,bankName:a.bankName,accountName:a.accountName,accountNumber:a.accountNumber}),$.success("Bank withdrawal request submitted successfully!"),x("confirmation")}catch(u){console.error("Bank withdrawal error:",u),i("An error occurred while processing your bank withdrawal. Please try again."),$.error("Failed to submit bank withdrawal request.")}finally{D(!1)}},F=a=>a.toFixed(2);if(o)return e.jsx("div",{className:"flex h-full min-h-96 items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(q,{className:"mx-auto h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"mt-2 text-lg",children:"Loading your balances..."})]})});if(r&&c!=="enter-bank-details")return e.jsx("div",{className:"flex h-full min-h-96 items-center justify-center",children:e.jsxs(p,{className:"w-full max-w-md",children:[e.jsx(w,{className:"bg-red-50 text-red-700",children:e.jsx(y,{children:"Error"})}),e.jsx(g,{className:"pt-6",children:e.jsx("p",{children:r})}),e.jsx(v,{className:"flex justify-center",children:e.jsx(h,{onClick:()=>window.location.reload(),className:"w-1/2",children:"Try Again"})})]})});if(A.length===0&&!o&&!r)return e.jsxs("div",{className:"container py-8 mx-auto text-center",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6 text-center",children:"Withdraw to Bank Account"}),e.jsx("p",{className:"text-xl text-gray-600 text-center",children:r||"You currently have no crypto balances with sufficient funds ($0.01 or more) to withdraw to a bank account."}),e.jsxs("p",{className:"mt-4",children:[e.jsx(C,{to:"/dashboard/deposit",className:"text-primary hover:underline",children:"Deposit funds"})," ","or"," ",e.jsx(C,{to:"/dashboard",className:"text-primary hover:underline",children:"return to dashboard"}),"."]})]});if(c==="select-crypto-source")return e.jsxs("div",{className:"container py-8 mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 text-center",children:"Withdraw to Bank Account"}),e.jsx("p",{className:"text-gray-600 mb-8 text-center",children:"Select the crypto balance you wish to withdraw funds from. The selected amount will be sent to your bank account in USD."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-w-4xl mx-auto",children:A.map(a=>{const u=n[a]||0;return e.jsxs(p,{className:"hover:shadow-md transition-shadow cursor-pointer",onClick:()=>H(a,u),children:[e.jsx(w,{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(X,{currency:a}),e.jsx(y,{children:a})]})}),e.jsx(g,{children:e.jsxs(B,{children:["Available Balance (USD):"," ",e.jsxs("span",{className:"font-semibold",children:["$",F(u)]})]})}),e.jsx(v,{className:"pt-0",children:e.jsxs(h,{variant:"ghost",className:"ml-auto",size:"sm",children:["Select & Continue ",e.jsx(V,{className:"ml-2 h-4 w-4"})]})})]},a)})}),e.jsx("div",{className:"mt-12 text-center",children:e.jsx(C,{to:"/dashboard/withdraw",children:e.jsxs(h,{variant:"outline",children:[e.jsx(L,{className:"mr-2 h-4 w-4"})," Back to Withdrawal Options"]})})})]});if(c==="enter-bank-details"&&m)return e.jsxs("div",{className:"container py-8 mx-auto flex flex-col items-center",children:[e.jsx("div",{className:"w-full max-w-sm mb-6",children:e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>{i(null),x("select-crypto-source")},children:[e.jsx(L,{className:"mr-2 h-4 w-4"})," Back to Select Balance"]})}),e.jsx(Q,{balanceToWithdrawFrom:m,onFormSubmit:I,isParentSubmitting:R}),r&&e.jsx("p",{className:"mt-4 text-sm text-red-600 text-center",children:r})]});if(c==="confirmation"&&d){const a=d.accountNumber.length>4?`****-****-****-${d.accountNumber.slice(-4)}`:d.accountNumber;return e.jsx("div",{className:"container mx-auto py-8",children:e.jsxs(p,{className:"max-w-lg mx-auto",children:[e.jsxs(w,{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-green-100",children:e.jsx(Z,{className:"h-6 w-6 text-green-600"})}),e.jsx(y,{className:"mt-4 text-xl",children:"Bank Withdrawal Request Submitted"})]}),e.jsxs(g,{className:"text-center space-y-3",children:[e.jsxs("p",{className:"text-gray-700",children:["Your request to withdraw"," ",e.jsxs("span",{className:"font-semibold",children:["$",F(parseFloat(d.amountUSD))]})," ","from your"," ",e.jsx("span",{className:"font-semibold",children:d.sourceCurrency})," ","balance to bank account ending in"," ",e.jsx("span",{className:"font-semibold",children:a})," (",d.accountName," at"," ",d.bankName,") has been submitted."]}),e.jsx("p",{className:"text-gray-600 text-sm",children:"This will be processed shortly. For now, the details have been logged to the console."}),r&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:r})]}),e.jsxs(v,{className:"flex flex-col sm:flex-row justify-center space-y-2 sm:space-y-0 sm:space-x-4",children:[e.jsx(h,{onClick:()=>{x("select-crypto-source"),f(null),U(null),i(null)},children:"Make Another Bank Withdrawal"}),e.jsx(h,{variant:"outline",onClick:()=>k({to:"/dashboard"}),children:"Return to Dashboard"})]})]})})}return null};export{ie as component};
